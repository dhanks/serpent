#!/bin/sh
#

# hacked configure script from Arkham-2 0.48 to work with Serpent.
# --
# pre@pre.org


SERVER_ROOT=`pwd`
SERVER_HOST=`hostname -f`
USERCONF=${SERVER_ROOT}/.defaults/userconf
SYSCONF=${SERVER_ROOT}/.defaults/sysconf
VERSION=`cat Version`

more README/README.copyright

if [ -e ${USERCONF} ]; then
   . ${USERCONF}
   cp ${USERCONF} ${USERCONF}.old
   echo "Found user configuration defaults file."
else
   . ${SYSCONF}
   echo "Using system configuration defaults file."
fi

echo ""
echo -n "Server name [${SERVER_NAME}]: "
read TEMP
if [ -n "${TEMP}" ]; then
   SERVER_NAME=${TEMP}
fi

echo -n "Port number [${SERVER_PORT}]: "
read TEMP
if [ -n "${TEMP}" ]; then
   SERVER_PORT=${TEMP}
fi

echo -n "Contact email address [${ADMIN_EMAIL}]: "
read TEMP
if [ -n "${TEMP}" ]; then
   ADMIN_EMAIL=${TEMP}
fi

echo -n "Server hostname [${SERVER_HOST}]: "
read TEMP
if [ -n "${TEMP}" ]; then
   SERVER_HOST=${TEMP}
fi

echo -n "Web site [${WEB_SITE}]: "
read TEMP
if [ -n "${TEMP}" ]; then
   WEB_SITE=${TEMP}
fi

echo -n "FTP site [${FTP_SITE}]: "
read TEMP
if [ -n "${TEMP}" ]; then
   FTP_SITE=${TEMP}
fi

echo -n "Root password [${ROOT_PASSWD}]: "
read TEMP
if [ -n "${TEMP}" ]; then
   ROOT_PASSWD=${TEMP}
fi

echo -n "Server binary [${SERVER_BIN}]: "
read TEMP
if [ -n "${TEMP}" ]; then
   SERVER_BIN=${TEMP}
fi

echo -n "Compile defs [${COMPILE_DEFS}]: "
read TEMP
if [ -n "${TEMP}" ]; then
   COMPILE_DEFS=${TEMP}
fi

clear
echo
echo "Confirm these details:"
echo
echo "Server name:   ${SERVER_NAME}"
echo "Server port:   ${SERVER_PORT}"
echo "Web site:      ${WEB_SITE}"
echo "Ftp site:      ${FTP_SITE}"
echo "Stack size:    ${STACK_SIZE}"
echo "Contact email: ${ADMIN_EMAIL}"
echo "Server binary: ${SERVER_BIN}"
echo "Root password: ${ROOT_PASSWD}"
echo "Compile defs:  ${COMPILE_DEFS}"
echo
echo
echo -n "Yes/No [Yes]: "
read TEMP
case ${TEMP} in
   "[Nn][Oo]" | "[Nn]" ) exit 1
   ;;
esac

clear
echo
echo "Using ${SERVER_ROOT} as server root."
echo


( echo "#!/bin/sh"
  echo "#"
  echo "SERVER_PORT=\"${SERVER_PORT}\""
  echo "SERVER_NAME=\"${SERVER_NAME}\""
  echo "WEB_SITE=\"${WEB_SITE}\""
  echo "FTP_SITE=\"${FTP_SITE}\""
  echo "STACK_SIZE=\"${STACK_SIZE}\""
  echo "ADMIN_EMAIL=\"${ADMIN_EMAIL}\""
  echo "SERVER_BIN=\"${SERVER_BIN}\""
  echo "ROOT_PASSWD=\"${ROOT_PASSWD}\""
  echo "COMPILE_DEFS=\"${COMPILE_DEFS}\"" ) > ${USERCONF}
chmod 700 ${USERCONF}

( echo "#!/bin/sh"
  echo "kill -9 \`cat ${SERVER_ROOT}/tmp/PID\`" ) > ${SERVER_ROOT}/bin/close_down
chmod 700 ${SERVER_ROOT}/bin/close_down
echo "Created ${SERVER_ROOT}/bin/close_down"

( echo; echo "/*"
  echo " * src/setup.h for ${SERVER_NAME}"
  echo -n " * Generated by Serpent ${VERSION} at "
  echo `date`; echo " */"
  echo "#define VERSION \"${VERSION}\""
  echo "#define SERVER_ROOT \"${SERVER_ROOT}/\""
  echo "#define SERVER_BIN \"${SERVER_BIN}\""
  echo "#define STACK_SIZE  ${STACK_SIZE}"
  echo "#define ROOT_PASSWD \"${ROOT_PASSWD}\"" 
  echo "#define SERVER_EMAIL \"${ADMIN_EMAIL}\""
  echo "#define SERVER_PORT ${SERVER_PORT}"
) > ${SERVER_ROOT}/src/setup.h
echo "Created ${SERVER_ROOT}/src/setup.h"

( echo "# Makefile for ${SERVER_NAME}"
  echo -n "# Generated by Serpent ${VERSION} at "
  echo `date`; echo "#"
  echo "# Please avoid editing this file manually. Use the 'configure'"
  echo "# utility instead and edit Makefile.in in the src/ directory."
  echo "#"
  echo "DEFS 		= ${COMPILE_DEFS}"
  echo "SERVER_ROOT     = ${SERVER_ROOT}"
  echo "SERVER_BIN 	= ${SERVER_BIN}"
  echo "VERSION         = ${VERSION}"
  cat  ${SERVER_ROOT}/src/Makefile.in 
) > ${SERVER_ROOT}/src/Makefile
echo "Created ${SERVER_ROOT}/src/Makefile"

echo; echo; echo
